#summary How to use diStorm in C, sample.

diStorm3 is backward compatible with diStorm64.
In this page I will show how to use diStorm64's interface, which only returns text.

Always start with:
{{{
#include "distorm.h"
}}}

{{{
// How many instructions to allocate on stack.
#define MAX_INSTRUCTIONS 32

// Holds the result of the decoding.
_DecodeResult res;

// Default offset for buffer is 0.
_OffsetType offset = 0;

// Decoded instruction information - the Decode will write the results here.
_DecodedInst decodedInstructions[MAX_INSTRUCTIONS];

// decodedInstructionsCount indicates how many instructions were written to the result array.
unsigned int decodedInstructionsCount = 0;

// Default decoding mode is 32 bits.
_DecodeType dt = Decode32Bits;

// Decode the buffer at given offset (virtual address).
res = distorm_decode(offset, (const unsigned char*)buf, filesize, dt, decodedInstructions, MAX_INSTRUCTIONS, &decodedInstructionsCount); 
if (res == DECRES_INPUTERR) { 
 // Error handling...
 // Note that even on error handling, you still should read the output normally!
 // So error really means that the array wasn't big enough.
} 
for (i = 0; i < decodedInstructionsCount; i++) { 
    printf("%0*I64x (%02d) %-24s %s%s%s\r\n", dt != Decode64Bits ? 8 : 16, decodedInstructions[i].offset, decodedInstructions[i].size, (char*)decodedInstructions[i].instructionHex.p, (char*)decodedInstructions[i].mnemonic.p, decodedInstructions[i].operands.length != 0 ? " " : "", (char*)decodedInstructions[i].operands.p); 
}
}}}
 